# 1장. 도메인 모델 시작하기

### 개요

---

- 도메인: 소프트웨어로 해결하고자 하는 문제 영역
- 하나의 도메인은 다시 여러개의 하위 도메인으로 나눌 수 있다.
    - 예시: `온라인 서점`이라는 도메인은 `주문`, `회원`, `리뷰` 등 여러 개의 하위 도메인으로 분리할 수 있다.
    - `온라인 서점`의 기능이 잘 동작하기 위해서는, 여러개의 하위 도메인이 상호작용하여 기능을 연동해야 한다.
- 개발자는 도메인 전문가 만큼은 아니더라도, 개발하는 분야의 `도메인 지식`을 공부하고 이해할 필요가 있다. 개발에 앞서 요구사항을 올바르게 이해하는 것이 중요하기 때문.

### 도메인 모델

---

- 정의: 특정 도메인을 개념적으로 표현한 것
- 도메인 모델의 구성 요소는 특정 도메인으로 한정할 때 비로소 의미가 완전해짐
    
    ⇒ 때문에, 하위 도메인별로 도메인 모델을 따로 만들어야 함
    
    - 예시: `온라인 서점` → `주문`, `회원`, `리뷰`
    - 기능 전체의 흐름을 크게 잡아 모델을 구성 X
    - `주문`이라는 하위 도메인의 모델을 구성해야 함
- 객체 기반, 상태 다이어그램 기반 등 여러 도표를 이용해 도메인 모델을 구성할 수 있음

### 도메인 모델 패턴

---

![Untitled](1%E1%84%8C%E1%85%A1%E1%86%BC%20%E1%84%83%E1%85%A9%E1%84%86%E1%85%A6%E1%84%8B%E1%85%B5%E1%86%AB%20%E1%84%86%E1%85%A9%E1%84%83%E1%85%A6%E1%86%AF%20%E1%84%89%E1%85%B5%E1%84%8C%E1%85%A1%E1%86%A8%E1%84%92%E1%85%A1%E1%84%80%E1%85%B5%2000cbee2934d046b1a739050eed2251d1/Untitled.png)

- 표현: 사용자 인터페이스로
    - 사용자 요청 처리 + 정보 보여줌
- 응용
    1. 요청 기능 실행
    2. 로직 직접 구현 X
    3. 도메인 계층 조합 + 기능 실행
- 도메인: 도메인 규칙 구현
- 인프라: 외부 시스템 연동(DB)

### ‼️ 도메인 규칙을 도메인 영역에서 처리한다는 관점

---

- 스프링 MVC 패턴에 도메인 모델 패턴을 적용한다면
    - 표현 ⇒ `@Controller`
    - 응용 ⇒ `@Service`에 해당
- 두 가지 조건을 갖고 개발한다고 가정
    1. 각 상품의 구매 가격 합은 상품 가격에 구매 개수를 곱한 값이다.
    2. 출고 전에 주문을 취소할 수 없다.
- 만약 위 두가지 규칙이 `도메인`에서 처리한다는 관점을 갖지 않는다면 다음과 같이 처리할 것
    1. RequestDTO로 구매하는 상품의 종류와 가격을 `@Service`에서 하나하나 리스트를 열어보며 처리한다.
    2. `@Service`에서 직접 DB를 조회해 출고 전 상태인지 확인한다.
- 하지만 도메인 영역을 사용한다면,
    1. Service에 RequestDTO가 보내지면
    2. 비교 * 분석하는 메서드는 도메인에서 해결

```java
/**
* 실제와는 관련이 크게 없으나
* 메서드의 사용을 표현하기 위한 예시 코드
*/
@Entity
public class Order {
    @Id
    public Long orderId;

    @Column
    public String name;

    @Column
    public Long price;

    public Long calculatePrice(List<OrderRequestDTO> requestDTOList){
        return requestDTOList.size() * this.price;
    }
}
```

### 엔티티 정의 시 주의점

---

1. 엔티티의 Value Type은 불변하게 구현한다
2. 도메인별로 식별자가 분명하게 존재해야 한다.
    1. 특정 규칙에 따라 생성
    2. UUID, Nano ID
    3. 값을 직접 입력
    4. 일련번호 사용 
3. 두 밸류 객체를 비교할 때 모든 속성이 같은지 비교한다.
    1. ✍🏻 기존에 개발할 땐 Object를 상속한 equals를 사용했는데, 엔티티 클래스에 커스텀해서 비교하는 게 더 좋을 것 같다는 생각
4. set 메서드를 넣지 않음
    1. 스프링의 경우 `@setter` 사용을 자제하기
    2. 도메인 객체를 생성할 때 온전하지 않은 상태가 될 수 있음
    3. 도메인의 핵심 개념이나 의도를 코드에서 사라지게 함
    4. 값을 변경할 때는 `@Builder` 패턴을 사용하자
5. 도메인 용어를 사용 할 때: 도메인 용어만 보고도 무슨 의미인지 파악할 수 있도록 하기